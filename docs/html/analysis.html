<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>analysis package &mdash; oTherm GSHP analysis  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="db_tools package" href="db_tools.html" />
    <link rel="prev" title="Modules" href="modules.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> oTherm GSHP analysis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="otherm_project.html">oTherm Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Modules</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html#analysis">analysis</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">analysis package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#modules">Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-analysis.daily_summaries">analysis.daily_summaries module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-analysis.load_summary">analysis.load_summary module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-analysis.ewt_violins">analysis.ewt_violins module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analysis-geoexchange-proxies-module">analysis.geoexchange_proxies module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analysis-hp-mfr-plots-module">analysis.hp_mfr_plots module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analysis-kwh-per-sf-module">analysis.kwh_per_sf module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analysis-load-factor-module">analysis.load_factor module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analysis-spf-with-uncertainty-module">analysis.spf_with_uncertainty module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analysis-time-of-day-usage-module">analysis.time_of_day_usage module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html#db-tools">db_tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="otherm_field_names.html">oTherm Database Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Credits and Disclaimers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">oTherm GSHP analysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="modules.html">Modules</a> &raquo;</li>
      <li>analysis package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/analysis.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="analysis-package">
<h1>analysis package<a class="headerlink" href="#analysis-package" title="Permalink to this headline"></a></h1>
<p>The analysis packages provided provide some examples of the potential uses of oTherm GSHP data.  These are provided as is and have the following limitations:</p>
<ul class="simple">
<li><p>Each site has a single heat pump.  The analyses presented can, in the future, be extended to multiple pieces of equipment.</p></li>
</ul>
<section id="modules">
<h2>Modules<a class="headerlink" href="#modules" title="Permalink to this headline"></a></h2>
</section>
<section id="module-analysis.daily_summaries">
<span id="analysis-daily-summaries-module"></span><h2>analysis.daily_summaries module<a class="headerlink" href="#module-analysis.daily_summaries" title="Permalink to this headline"></a></h2>
<p>Calculation of daily performance metrics for a given piece of equipment (e.g. a heat pump).  This function is also
embedded in oTherm instance and can be updated daily as a cron job.  Included here to document methods and allow
for customization.</p>
<dl class="simple">
<dt>Daily metrics include, each integrated for one day:</dt><dd><ul class="simple">
<li><p>Heating and cooling degree days, relative to 65F base temperature</p></li>
<li><p>Heat pump run time (hours)</p></li>
<li><p>Heat pump energy usage (kWh)</p></li>
<li><p>Auxiliary heat energy usage (kWh)</p></li>
<li><p>Thermal energy generated by heat pump under heating and cooling modes (MBtu)</p></li>
<li><p>Thermal energy exchanged with the ground (MBtu)</p></li>
<li><p>Average outdoor air temperature (F)</p></li>
<li><p>Source minimum and maximum temperatures (F)</p></li>
<li><p>Number of monitoring records for day</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Modifying this script will not change calculations in oTherm instance.  See oTherm instance administrator to update
codebase.</p>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="analysis.daily_summaries.create_daily_summaries">
<span class="sig-prename descclassname"><span class="pre">analysis.daily_summaries.</span></span><span class="sig-name descname"><span class="pre">create_daily_summaries</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">heatpump_threshold_watts</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#analysis.daily_summaries.create_daily_summaries" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>pandas.DataFrame</em>) – Heat pump operating data from oTherm db</p></li>
<li><p><strong>heatpump_threshold_watts</strong> (<em>float</em>) – Threshold to determine if heat pump is on or off.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>pandas.DataFrame</em></p></li>
<li><p><em>The returned DataFrame contains daily summary metrics described above</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-analysis.load_summary">
<span id="analysis-load-summary-module"></span><h2>analysis.load_summary module<a class="headerlink" href="#module-analysis.load_summary" title="Permalink to this headline"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="analysis.load_summary.load_summary_graph">
<span class="sig-prename descclassname"><span class="pre">analysis.load_summary.</span></span><span class="sig-name descname"><span class="pre">load_summary_graph</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">site</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#analysis.load_summary.load_summary_graph" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>DataFrame</em>) – Pandas ddataframe containing daily summaries</p></li>
<li><p><strong>site</strong> (<em>dict</em>) – Dataclass object containing site information</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-analysis.ewt_violins">
<span id="analysis-ewt-violins-module"></span><h2>analysis.ewt_violins module<a class="headerlink" href="#module-analysis.ewt_violins" title="Permalink to this headline"></a></h2>
<p>Creates histograms of the heat pump entering water temperature averaged on hourly intervals using the Seaborn library.
When multiple site names are provided, histograms are plotted along the x axis and labeled with the site name.</p>
<p>When multiple sites are plotted, the <em>seaborn.violinplot</em> parameters are set to prodcue histograms that are equal width
with the area of each mode scaled to the relative number of hours in heating or cooling.</p>
<dl class="py function">
<dt class="sig sig-object py" id="analysis.ewt_violins.determine_mode">
<span class="sig-prename descclassname"><span class="pre">analysis.ewt_violins.</span></span><span class="sig-name descname"><span class="pre">determine_mode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">row</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#analysis.ewt_violins.determine_mode" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>row</strong> – a row in a pandas DataFrame</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>new column in the DataFrame, that identifies when heat pump is heating or cooling</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="analysis.ewt_violins.ewt_violins">
<span class="sig-prename descclassname"><span class="pre">analysis.ewt_violins.</span></span><span class="sig-name descname"><span class="pre">ewt_violins</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">site_names</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#analysis.ewt_violins.ewt_violins" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>site_names</strong> (<em>list</em>) – A list of site names to include in analyis.  Each site will have it’s own violin plot</p></li>
<li><p><strong>start_date</strong> (<em>str</em>) – Start date of analysis in format ‘YYYY-MM-DD’</p></li>
<li><p><strong>end_date</strong> (<em>str</em>) – End date of analysis in format ‘YYYY-MM-DD’</p></li>
<li><p><strong>timezone</strong> (<em>str</em>) – Timezone of installation</p></li>
<li><p><strong>db</strong> (<em>str</em>) – oTherm database to use for analysis</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The image is written to a file in the ../temp_files directory</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>image file</p>
</dd>
</dl>
</dd></dl>

<p>Example output:</p>
<a class="reference internal image-reference" href="_images/ewt_violin_plots.png"><img alt="Example violin plots that show histograms of the entering water temperature under heating and cooling modes." src="_images/ewt_violin_plots.png" style="width: 400px;" /></a>
</section>
<section id="analysis-geoexchange-proxies-module">
<h2>analysis.geoexchange_proxies module<a class="headerlink" href="#analysis-geoexchange-proxies-module" title="Permalink to this headline"></a></h2>
</section>
<section id="analysis-hp-mfr-plots-module">
<h2>analysis.hp_mfr_plots module<a class="headerlink" href="#analysis-hp-mfr-plots-module" title="Permalink to this headline"></a></h2>
</section>
<section id="analysis-kwh-per-sf-module">
<h2>analysis.kwh_per_sf module<a class="headerlink" href="#analysis-kwh-per-sf-module" title="Permalink to this headline"></a></h2>
<p>One particularly helpful analysis that can be accomplished with very simple monitoring equipment is the energy usage as a function of conditioned area and outdoor air temperature.   One application of this analysis offers an opportunity to compare the efficiency of different technologies, such as air-source and ground-source heat pumps over a wide range of outdoor weather conditions (e.g., Ueno and Loomis, 2015).</p>
<span class="target" id="module-analysis.kwh_per_sf"></span><p>This module creates a scatterplot of energy use intensity as a function of average daily
outdoor air temperature.</p>
<dl class="py function">
<dt class="sig sig-object py" id="analysis.kwh_per_sf.kwh_vs_oat">
<span class="sig-prename descclassname"><span class="pre">analysis.kwh_per_sf.</span></span><span class="sig-name descname"><span class="pre">kwh_vs_oat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">site_names</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#analysis.kwh_per_sf.kwh_vs_oat" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>site_names</strong> (<em>list</em>) – List of site names, as strings</p></li>
<li><p><strong>start_date</strong> (<em>str</em>) – Beginning date of request, such as <em>‘2015-01-01’</em></p></li>
<li><p><strong>end_date</strong> (<em>str</em>) – End date of request</p></li>
<li><p><strong>symbol_colors</strong> (<em>dict</em>) – Dictionary of colors for graph symbols with site name as keys</p></li>
<li><p><strong>db</strong> (<em>str</em>) – The name of the database to pull operating data from</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p>Example output:</p>
<a class="reference internal image-reference" href="_images/kwh_per_sf_v_oat.png"><img alt="Example plot of time of energy use intensity as a function of outdoor air temperature" src="_images/kwh_per_sf_v_oat.png" style="width: 400px;" /></a>
</section>
<section id="analysis-load-factor-module">
<h2>analysis.load_factor module<a class="headerlink" href="#analysis-load-factor-module" title="Permalink to this headline"></a></h2>
<p>Because adoption of GSHP systems will often replace fossil-fuel fired systems and represent more energy intensive appliances in a home, electric utilities are also interested in the load factors for typical residential GSHP systems and the month-to-month variation in load factors over the course of a year.  For the purposes here, the load factor is defined as the ratio of the electricity consumed over a period of time, such as one month, to the consumption that would have occurred if the peak demand operated over the entire month.   The load factor ranges from 0 to 1, with higher values representing more uniform and predictable demand.</p>
<div class="math notranslate nohighlight">
\[Load Factor = \frac{kWh_{used \: in \: period}}{{kW_{peak} \cdot (hours \: in \: period)} }\]</div>
<span class="target" id="module-analysis.load_factor"></span><div class="admonition note">
<p class="admonition-title">Note</p>
<p>runs correctly with limited oTherm data,  still needs full testing</p>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="analysis.load_factor.generate_csv">
<span class="sig-prename descclassname"><span class="pre">analysis.load_factor.</span></span><span class="sig-name descname"><span class="pre">generate_csv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">site_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#analysis.load_factor.generate_csv" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>pandas.DataFrame</em>) – Heat pump operating data with datetime index</p></li>
<li><p><strong>site_name</strong> (<em>str</em>) – Name of the site to analyze.  At present, assumes a single heat pump at each site.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>Produces a csv file with the following columns:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>month_and_year</p></td>
<td><p>year and month of analysis</p></td>
</tr>
<tr class="row-even"><td><p>Compressor (kWh)</p></td>
<td><p>total energy consumption of compressor</p></td>
</tr>
<tr class="row-odd"><td><p>Auxiliary (kWh)</p></td>
<td><p>total energy consumption of compressor</p></td>
</tr>
<tr class="row-even"><td><p>Total Load (kWh)</p></td>
<td><p>sum of Compressor and Auxiliary energy consumption</p></td>
</tr>
<tr class="row-odd"><td><p>Compressor Peak (hourly)</p></td>
<td><p>peak hourly electric power (kW) for compressor</p></td>
</tr>
<tr class="row-even"><td><p>Auxiliary Peak (hourly)</p></td>
<td><p>peak hourly electric power (kW) for auxiliary</p></td>
</tr>
<tr class="row-odd"><td><p>Total Peak (hourly)</p></td>
<td><p>peak hourly electric power (kW) over period</p></td>
</tr>
<tr class="row-even"><td><p>Load Factor (Total)</p></td>
<td><p>calculated load factor for month</p></td>
</tr>
<tr class="row-odd"><td><p>intervals</p></td>
<td><p>number of 1-minute interval data over month</p></td>
</tr>
<tr class="row-even"><td><p>completeness</p></td>
<td><p>number of intervals divided by minutes in month</p></td>
</tr>
</tbody>
</table>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>csv file</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="analysis-spf-with-uncertainty-module">
<h2>analysis.spf_with_uncertainty module<a class="headerlink" href="#analysis-spf-with-uncertainty-module" title="Permalink to this headline"></a></h2>
<p>The seasonal performance factor (SPF) is a metric used to evaluate the performance of installed heat pumps.  SPF values
are sometimes separated into monthly values or values binned on ranges of entering water temperatures.</p>
<p>In heating mode, the SPF is calculated similarly to the COP.  The difference is that COP values are determined under
laboratory conditions while the SPF values are calculated using real-world operational data.  Further, while COPs are
measured with laboratory-grade equipment, calculation of SPFs may use estimated or proxy values in lieu of measured values,
depending on the availability and quality of data.   The heating SPF is calculated as the ratio of the heating or
cooling provided and the electricity used to generate the heating or cooling:</p>
<div class="math notranslate nohighlight">
\[SPF=\frac{\text{Heating or Cooling Provided [kWh]}}{\text{Electricity Used [kWh]}}\]</div>
<p>When calculating SPF values, it is important to note the boundaries of the analysis.  Spitler and Gehlin (2020) build
upon the SEPEMO boundaries defined by Nordman and others (2012) to delineate a set of nested boundaries the include
successively more components of the system.</p>
<p>Uncertainty Analysis
One of the primary challenges in analyzing SPF values and comparing them between systems or with laboratory-rate COP
values is the uncertainty associated with measurements used to calculate the SPF values.  All measurements have some
degree of associated uncertainty, but field measurements used to calculate SPF values generally are obtained with lower
quality sensors than those used the laboratory to calculate COP values.  As a result, they have a larger uncertainty due
to sensor bias.   Most studies that report measured performance (COP or SPF) do not quantify uncertainty (e.g.,
Puttagunta et al., 2010; Huelman et al., 2016) even though it can be significant.</p>
<p>Uncertainty due to sensor bias can be absolute or fractional. Absolute uncertainty has the same units as the value being
measured.  Fractional uncertainty is a fraction of the measured value. While the sensor bias for a given sensor will be
constant, the impact on the uncertainty of the calculated SPF depends on the measured value, which changes in time.  This
is of particular concern with the uncertainty of a measure of temperature difference.</p>
<p>Calculating the SPF of GSHP systems relies on quantifying the geoexchange (thermal energy exchanged with the subsurface)
and the electricity used by the GSHP system. Quantifying the geoexchange requires taking the product of density and
specific heat capacity of the heat transfer fluid, the mass flow rate of the heat transfer fluid, and the temperature
change of the heat transfer fluid across the heat pump. The uncertainties in the density and specific heat capacity
values are very small relative to the other uncertainties and are typically ignored (Spitler et al., in prep).  The
temperature change of the heat transfer fluid has a constant absolute uncertainty, meaning that the true temperature
change is within a fixed number of degrees from the measured value. Electricity usage measurements can have a fractional
or absolute uncertainty, depending on the measurement method.</p>
<p>Because the uncertainty of geoexchange and the electrical consumption of the GSHP system (EQ and Ew, respectively) can
change depending on the actual conditions, the uncertainty must be calculated separately for each timestep in the
period of interest. Following Taylor (1997), the fractional uncertainty for thermal energy exchanged with the subsurface
and the electrical consumption (eQ and eW, respectively) can then be calculated as:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}e_{Q,n}= \frac{\sum_{i=1}^{n}E_{Q,n}}{\sum_{i=1}^{n}Q_i}\\e_{W,n}= \frac{\sum_{i=1}^{n}E_{W,n}}{\sum_{i=1}^{n}W_i}\end{aligned}\end{align} \]</div>
<p>Where Qi and Wi are the measured values of the geoexchange and electrical consumption, respectively.   The quantities
are summed over n time intervals, typically each 1-minute in duration.</p>
<p>The fractional uncertainty of the SPF value can then be obtained by adding the fractional uncertainties of the thermal
energy exchanged with the subsurface and the electrical consumption of the GSHP system in quadrature:</p>
<div class="math notranslate nohighlight">
\[e_{SPF,n}=\ \sqrt(e_{Q,n}^2+e_{W,n}^2\ )\]</div>
<p>While this description of uncertainty analysis focuses on SPF calculations, as they involve multiple types of
measurements, uncertainty analysis should also be performed when calculating and reporting other key performance
indicators.</p>
<p>Example output:</p>
<a class="reference internal image-reference" href="_images/spf_plots.png"><img alt="Example seasonal performance factor (SPF) with uncertainty for heating mode" src="_images/spf_plots.png" style="width: 400px;" /></a>
<span class="target" id="module-analysis.spf_with_uncertainty"></span><p>&#64;author: Ryan Chase, University of New Hampshire</p>
<dl class="py function">
<dt class="sig sig-object py" id="analysis.spf_with_uncertainty.lag_temps">
<span class="sig-prename descclassname"><span class="pre">analysis.spf_with_uncertainty.</span></span><span class="sig-name descname"><span class="pre">lag_temps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">initial_data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#analysis.spf_with_uncertainty.lag_temps" title="Permalink to this definition"></a></dt>
<dd><p>Lag temperature measurements by one value.   Necessary for on-pipe measurements.
Assumes that operating data is at minute-resolution and thermal response of temperature sensors is
approximately one minute.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>initial_data</strong> (<em>pd.DataFrame</em>) – Data as initially pulled from database.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>Dataframe with lagged temperature measurements. Additional column
is as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>DeltaT</p></td>
<td><p>circulating fluid temperature change (as <cite>float</cite>)</p></td>
</tr>
</tbody>
</table>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="analysis.spf_with_uncertainty.to_kilowatts">
<span class="sig-prename descclassname"><span class="pre">analysis.spf_with_uncertainty.</span></span><span class="sig-name descname"><span class="pre">to_kilowatts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">derate</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">power_fac</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#analysis.spf_with_uncertainty.to_kilowatts" title="Permalink to this definition"></a></dt>
<dd><p>Unit conversion and electricity usage/heat rate adjustments.</p>
<p>Converts heat flow from btu/hr to kW and electricity from W to kW.
Scales heat flow and electricity consumption values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>pd.DataFrame</em>) – Heat pump operational data.</p></li>
<li><p><strong>derate</strong> (<em>float</em>) – Scales heat flow values.</p></li>
<li><p><strong>power_fac</strong> (<em>float</em>) – Scales electricity usage.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>Dataframe with unit conversion and necessary scaling applied to
electricity usage and heatflow. Additional columns are
as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>q</p></td>
<td><p>heat flow in kW with scaling (as <cite>float</cite>)</p></td>
</tr>
<tr class="row-even"><td><p>kw_used</p></td>
<td><p>electricity usage in kW with scaling (as <cite>float</cite>)</p></td>
</tr>
</tbody>
</table>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="analysis.spf_with_uncertainty.error_heat_from_ground">
<span class="sig-prename descclassname"><span class="pre">analysis.spf_with_uncertainty.</span></span><span class="sig-name descname"><span class="pre">error_heat_from_ground</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mrl_hr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">E_deltaT</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">e_v</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#analysis.spf_with_uncertainty.error_heat_from_ground" title="Permalink to this definition"></a></dt>
<dd><p>Calculates error associated with heat transfer from ground.</p>
<p>Converts heat flow from btu/hr to kW and electricity from W to kW.
Scales heat flow and electricity consumption values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mrl_hr</strong> (<em>float</em>) – Max record length in hours.</p></li>
<li><p><strong>E_deltaT</strong> (<em>float</em>) – Absolute uncertainty in temperature change of circulating fluid.</p></li>
<li><p><strong>e_v</strong> (<em>float</em>) – Flow rate fractional error.</p></li>
<li><p><strong>data</strong> (<em>pd.Dateframe</em>) – Heatpump operational data.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>Dataframe with additional columns associated with error in heat
exchange rates. Additional columns are as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>e_deltaT</p></td>
<td><p>fractional uncertainty deltaT (as <cite>float</cite>)</p></td>
</tr>
<tr class="row-even"><td><p>e_q</p></td>
<td><p>fractional uncertainty heat transfer rate (as <cite>float</cite>)</p></td>
</tr>
<tr class="row-odd"><td><p>E_q</p></td>
<td><p>absolute uncertainty heat transfer rate (as <cite>float</cite>)</p></td>
</tr>
<tr class="row-even"><td><p>tvalue</p></td>
<td><p>date time (as <cite>datetime64[ns, UTC]</cite>)</p></td>
</tr>
<tr class="row-odd"><td><p>timedelta</p></td>
<td><p>time since last timestep (as <cite>timedelta64[ns]</cite>)</p></td>
</tr>
<tr class="row-even"><td><p>elapsed_hours</p></td>
<td><p>hours since last timestep (as <cite>float</cite>)</p></td>
</tr>
<tr class="row-odd"><td><p>E_Q</p></td>
<td><p>absolute uncertainity in kWh to/from ground (as <cite>float</cite>)</p></td>
</tr>
</tbody>
</table>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="analysis.spf_with_uncertainty.elec_error_single_elec_measurement">
<span class="sig-prename descclassname"><span class="pre">analysis.spf_with_uncertainty.</span></span><span class="sig-name descname"><span class="pre">elec_error_single_elec_measurement</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">e_e</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#analysis.spf_with_uncertainty.elec_error_single_elec_measurement" title="Permalink to this definition"></a></dt>
<dd><p>Calculates absolute electrical error.</p>
<p>For datasets that include a single electricity consumption value.
Calculates absolute electrical error for each timestep in kWh.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>e_e</strong> (<em>float</em>) – Fractional uncertainty of electricity usage.</p></li>
<li><p><strong>error_data</strong> (<em>pd.Dateframe</em>) – Heatpump operational data.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>Dataframe with additional column for electricity usage uncertainty.
Additional column is as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 95%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>E_W</p></td>
<td><p>absolute electrical uncertainity in kWh (as <cite>float</cite>)</p></td>
</tr>
</tbody>
</table>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="analysis.spf_with_uncertainty.heat_calcs_single_elec_measurement">
<span class="sig-prename descclassname"><span class="pre">analysis.spf_with_uncertainty.</span></span><span class="sig-name descname"><span class="pre">heat_calcs_single_elec_measurement</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">error_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pump_power</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#analysis.spf_with_uncertainty.heat_calcs_single_elec_measurement" title="Permalink to this definition"></a></dt>
<dd><p>Calculates heat flow and electricity usage during heating periods.</p>
<p>For datasets that include a single electricity consumption value.
Considers electricity consumption of single stage circulating pump that will not
contribute useful heat to building.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>error_data</strong> (<em>pd.Dateframe</em>) – Heatpump operational data.</p></li>
<li><p><strong>pump_power</strong> (<em>float</em>) – Electricity consumption of single stage circulating pump.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>Dataframe with additional columns associated with heatflow and
electricity consumption. Additional columns are as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 78%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>electricity_kWh</p></td>
<td><p>electricity kWh used in heating mode (as <cite>float</cite>)</p></td>
</tr>
<tr class="row-even"><td><p>hfg</p></td>
<td><p>heat from ground in kWh (as <cite>float</cite>)</p></td>
</tr>
<tr class="row-odd"><td><p>pump_power</p></td>
<td><p>pump electricity usage in Kw (as <cite>float</cite>)</p></td>
</tr>
<tr class="row-even"><td><p>heat_provided</p></td>
<td><p>heat provided to building in kWh (as <cite>float</cite>)</p></td>
</tr>
</tbody>
</table>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="analysis.spf_with_uncertainty.total_heat_sum_error">
<span class="sig-prename descclassname"><span class="pre">analysis.spf_with_uncertainty.</span></span><span class="sig-name descname"><span class="pre">total_heat_sum_error</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spf_heat_data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#analysis.spf_with_uncertainty.total_heat_sum_error" title="Permalink to this definition"></a></dt>
<dd><p>Total values for heating and overall heating spf.</p>
<p>Uses heating operational data. Calculate total heat extracted from
ground and absolute error. Also calculates spf and fractional error.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>spf_heat_data</strong> (<em>pd.Dateframe</em>) – Heatpump operational data during heating.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>total_ground_heat</strong> (<em>float</em>) – Total heat from ground in kWh.</p></li>
<li><p><strong>total_gh_error</strong> (<em>float</em>) – Absolute error of total heat from ground in kWh.</p></li>
<li><p><strong>total_heat_spf</strong> (<em>float</em>) – Heating spf.</p></li>
<li><p><strong>ah_e_spf</strong> (<em>float</em>) – Heating fractional uncertainity of SPF.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="analysis.spf_with_uncertainty.monthly_ground_heat">
<span class="sig-prename descclassname"><span class="pre">analysis.spf_with_uncertainty.</span></span><span class="sig-name descname"><span class="pre">monthly_ground_heat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spf_heat_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percent_max</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#analysis.spf_with_uncertainty.monthly_ground_heat" title="Permalink to this definition"></a></dt>
<dd><p>Calculates monthly heat flow and spf values for plotting.</p>
<p>Resamples data to monthly values.
Determines which months have signifigant heating loads to be plotted.
Calculates monthly spf values and absolute uncertainty for plotting.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spf_heat_data</strong> (<em>pd.Dateframe</em>) – Heatpump operational data during heating.</p></li>
<li><p><strong>percent_max</strong> (<em>float</em>) – Multipled by highest heating month to determine minimum kWh to plot.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>Dataframe with additional columns associated with monthly heatflow
and spf. Additional columns are as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 72%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>year</p></td>
<td><p>year of each timestep (as <cite>str</cite>)</p></td>
</tr>
<tr class="row-even"><td><p>month_and_year</p></td>
<td><p>year and month of each timestep (as <cite>str</cite>)</p></td>
</tr>
<tr class="row-odd"><td><p>monthly_heating_spf</p></td>
<td><p>heating spf value for month (as <cite>float</cite>)</p></td>
</tr>
<tr class="row-even"><td><p>fhe</p></td>
<td><p>heating fractional uncertainity (as <cite>float</cite>)</p></td>
</tr>
<tr class="row-odd"><td><p>fee</p></td>
<td><p>electric fractional uncertainity (as <cite>float</cite>)</p></td>
</tr>
<tr class="row-even"><td><p>e_spf</p></td>
<td><p>fractional uncertainity heating SPF (as <cite>float</cite>)</p></td>
</tr>
<tr class="row-odd"><td><p>E_spf</p></td>
<td><p>absolute uncertainity heating SPF (as <cite>float</cite>)</p></td>
</tr>
</tbody>
</table>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="analysis-time-of-day-usage-module">
<h2>analysis.time_of_day_usage module<a class="headerlink" href="#analysis-time-of-day-usage-module" title="Permalink to this headline"></a></h2>
<p>There is a growing interest in quantifying hourly demand profiles for building heat and cooling to manage generation assets and explore models for demand-response programs (e.g., National Academies, 2021).   While heat pump usage patterns tend to vary with season – with winters having higher demand in morning and summer a higher demand in the afternoon – specific usage patterns depend on preferences of building occupants and individual usage patterns.  Quantifying patterns of usage across a large number of heat pumps in a given regions will help to inform utilities in forecasting weather-dependent generation patterns and identify opportunities for demand response measures.</p>
<span class="target" id="module-analysis.time_of_day_usage"></span><p>This module calculates the aggregate statistics for kW on an hourly, time-of-day basis
Currently calculates mean and 90th quantile for each hour and creates matplotlib plot.  It is currently
set up for a single year but should be extendable to multiple years.</p>
<dl class="py function">
<dt class="sig sig-object py" id="analysis.time_of_day_usage.hourly_daily_stats">
<span class="sig-prename descclassname"><span class="pre">analysis.time_of_day_usage.</span></span><span class="sig-name descname"><span class="pre">hourly_daily_stats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">site</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hp_data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#analysis.time_of_day_usage.hourly_daily_stats" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>site</strong> – </p></li>
<li><p><strong>hp_data</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p>Example output:</p>
<a class="reference internal image-reference" href="_images/time_of_day_usage.png"><img alt="Example plot of time of day usage for a site with the ground source heat pump" src="_images/time_of_day_usage.png" style="width: 400px;" /></a>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="modules.html" class="btn btn-neutral float-left" title="Modules" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="db_tools.html" class="btn btn-neutral float-right" title="db_tools package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Matt Davis, Univeristy of New Hampshire.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>